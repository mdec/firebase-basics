<html>
<head>
	<style>
		body {
			width: 50%;
			margin: auto;
			background-color: #eee;
		}

		#message-log {
			background-color: #fff;
			border: 2px solid #999;
			height: 75%;
			font-size: 20px;
			margin-top: 20px;
			margin-bottom: 20px;
			overflow-wrap: break-word;
			overflow-y: scroll;
			padding: 15px;
		}

		#message-input {
			width: 100%;
			height: 36px;
			font-size: 18px;
			vertical-align: top;
		}

		#signup-signin {
			padding-top: 10px;
		}

		/*
		#logged-out, #logged-in {
			display: none;
		}
		*/

		
	</style>
</head>
<body>

	<div id='logged-out'>
		<form id='signup-signin'>
			<input type='text' id='email' placeholder='Email'>
			<input type='password' id='password' placeholder='Password'>
			<button type='submit'>Sign up / Sign in</button>
		</form>
	</div>

	<div id='logged-in'>
		<div id='message-log'>
		</div>

		<form id='message-form'>
		<input type='text' id='message-input' placeholder='Type a message and press Enter...'>
		</form>
	</div>

</body>

	
	
	<script src="https://www.gstatic.com/firebasejs/3.9.0/firebase.js"></script>
	<script>
	/* 1. 
	  // Initialize Firebase
	  
	  */
	</script>
	<script>
	
	var messageLog = document.getElementById('message-log');
	var messageInput = document.getElementById('message-input');
	var messageForm = document.getElementById('message-form');

	var email = '';

	messageForm.onsubmit = function(e) {
		var message = messageInput.value;
		messageLog.innerHTML += messageInput.value + '<br/>'
		
		/* 3.
		firebase.database().ref('/messages').push({
			email: firebase.auth().currentUser.email,
			message: message
		});
		*/
		
		/* 7. 
		firebase.database().ref('/users/' + firebase.auth().currentUser.uid + '/posts').transaction(
			function(currentPosts) {
				return currentPosts + 1;
			});
		*/

		messageInput.value = '';
		
		return false;
	};

	/* 2.
	document.getElementById('signup-signin').onsubmit = function(e) {

		var email = document.getElementById('email').value;
		var password = document.getElementById('password').value;
		
		firebase.auth().signInWithEmailAndPassword(email, password).then( function(user) {
				console.log('logged in as ' + user.email);
	    	})
      		.catch( function(error) {
      			console.log(error.code);

        		if (error.code === 'auth/user-not-found') {
	          		firebase.auth().createUserWithEmailAndPassword(email, password).then( function(user) {
			          console.log('user created');

			          firebase.database().ref('/users/' + user.uid).set({
			          	email: user.email,
			          	posts: 0
			          });
			        })
        		}
        	});
      
		return false;
	};
	*/

	/* 4.
	firebase.auth().onAuthStateChanged( function(user) {

		if (user) {
			document.getElementById('logged-in').style.display = 'block';
			document.getElementById('logged-out').style.display = 'none';

			//5. firebase.database().ref('/messages').once('value', 
			//6. firebase.database().ref('/messages').on('value',
			//7. firebase.database().ref('/messages').limitToLast(15).on('value', 
				function(data) {
					var messages = data.val();

					messageLog.innerHTML = '';

					for (key in messages) {
						message = messages[key];
						messageLog.innerHTML += '<strong>' + message.email + ':</strong> ' + message.message + '<br/>';
					}
			});
		} else {
			document.getElementById('logged-out').style.display = 'block';
			document.getElementById('logged-in').style.display = 'none';
		}

	});
	*/

</script>
</html>